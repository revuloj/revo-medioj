apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: formiko
  name: formiko
spec:
  replicas: 1
  selector:
    matchLabels:
      app: formiko  
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: formiko
    spec:
      containers:
      - args:
        - bash
        - -c
        - su -c 'ssh -i /secrets/voko-formiko/ssh_key -o StrictHostKeyChecking=no
          -o PasswordAuthentication=no afido@afido exit' formiko && cron -f
        image: voko-formiko
        name: formiko
        resources: {}
        volumeMounts:
        - mountPath: /formiko-agordo-cron
          name: formiko-agordo-cron
        - mountPath: /home/formiko/etc/
          name: formiko-agordo-redaktoservo
        - mountPath: /home/formiko/revo
          name: formiko-revo
        - mountPath: /home/formiko/tmp
          name: formiko-tmp
        - mountPath: /home/formiko/log
          name: formiko-log
        - mountPath: /var/mail
          name: mail
        - mountPath: /secrets/voko-sesio
          name: voko-sesio
          readOnly: true
        - mountPath: /secrets/voko-araneo
          name: voko-araneo
          readOnly: true
        - mountPath: /secrets/voko-formiko
          name: voko-formiko
          readOnly: true
      restartPolicy: Always
      volumes:
      - configMap:
          defaultMode: 420
          name: formiko-agordo-cron
        name: formiko-agordo-cron
      - configMap:
          defaultMode: 292
          name: formiko-agordo-redaktoservo
        name: formiko-agordo-redaktoservo
      - name: voko-formiko
        secret:
          secretName: voko-formiko
      - name: voko-sesio
        secret:
          secretName: voko-sesio
          items:
          - key: ftp_password    
            path: ftp_password      
      - name: voko-araneo
        secret:
          secretName: voko-araneo
          items:
          - key: cgi_password          
            path: cgi_password      
      - name: formiko-revo
        persistentVolumeClaim:
          claimName: formiko-revo
      - name: formiko-tmp
        persistentVolumeClaim:
          claimName: formiko-tmp
      - name: formiko-log
        persistentVolumeClaim:
          claimName: formiko-log
      - name: mail
        persistentVolumeClaim:
          claimName: mail
status: {}
